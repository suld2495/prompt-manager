# 프롬프트 관리 시스템 기획서

## 📋 프로젝트 개요

### 목적
방대한 AI 프롬프트를 체계적으로 관리하고, 재사용 가능한 모듈 단위로 조합하여 최종 MD 파일을 생성하는 시스템

### 핵심 가치
- **모듈화**: 작은 규칙 단위로 분해
- **재사용성**: 규칙/카테고리/프리셋을 여러 템플릿에서 공유
- **프리셋**: 자주 쓰는 카테고리 조합을 미리 저장
- **스냅샷 관리**: MD 생성 시점의 규칙 내용 보존
- **변경 추적**: 원본 규칙 변경 시 스냅샷과 비교 알림

---

## 🏗️ 시스템 구조

### 4계층 아키텍처

```
규칙 (Rule)
  ├─ 가장 작은 단위
  ├─ 마스터 규칙 (항상 최신 내용)
  └─ 재사용 가능 (여러 카테고리에 포함)
  
카테고리 (Category)
  ├─ 규칙들의 그룹
  ├─ 평면 구조 (트리 없음) ⭐
  └─ 재사용 가능 (여러 프리셋/템플릿에 포함)
  
카테고리 프리셋 (Category Preset) ⭐ NEW
  ├─ 카테고리들의 조합
  ├─ 자주 쓰는 세트를 미리 저장
  └─ 재사용 가능 (여러 템플릿에서 사용)
  
템플릿 (Template)
  ├─ 프리셋 + 개별 카테고리 조합
  ├─ 최상위 (재사용 불가)
  ├─ MD 생성 시 스냅샷 생성
  └─ 최종 MD 파일 생성
```

---

## 🎯 계층별 예시

### 규칙 (개별)
```
- useState 3개 제한
- useEffect 2개 제한
- 컴포넌트 네이밍 규칙
- try-catch 필수
- 에러 메시지 명확
- any 타입 금지
```

### 카테고리 (평면)
```
📁 React 기본 규칙
   └─ useState 3개 제한, useEffect 2개 제한, 컴포넌트 네이밍

📁 JavaScript 에러 처리
   └─ try-catch 필수, 에러 메시지 명확

📁 TypeScript 기본
   └─ any 타입 금지, 타입 명시 필수

📁 코드 컨벤션
   └─ 들여쓰기 2칸, 따옴표 single
```

### 카테고리 프리셋 (조합) ⭐
```
📦 React 표준 프리셋
   ├─ React 기본 규칙
   ├─ JavaScript 에러 처리
   ├─ TypeScript 기본
   └─ 코드 컨벤션

📦 Vue 표준 프리셋
   ├─ Vue 기본 규칙
   ├─ JavaScript 에러 처리
   └─ 코드 컨벤션

📦 Fullstack 기본 프리셋
   ├─ JavaScript 에러 처리
   ├─ TypeScript 기본
   ├─ 코드 컨벤션
   └─ API 설계 규칙
```

### 템플릿 (최종)
```
📄 React Next.js 풀스택
   ├─ [프리셋] React 표준 프리셋
   │   └─ (4개 카테고리 포함)
   └─ [추가] Next.js 전용 규칙 (개별 카테고리)

📄 React SPA
   ├─ [프리셋] React 표준 프리셋
   └─ [추가] SPA 라우팅 규칙

📄 Vue 3 프로젝트
   └─ [프리셋] Vue 표준 프리셋
```

---

## 🔑 핵심 개념: 스냅샷

### 스냅샷이란?
MD 파일을 생성한 시점의 규칙 내용을 보존한 것

### 언제 생성되나?
템플릿에서 [MD 생성] 버튼 클릭 시

### 왜 필요한가?
```
시나리오:
1. "useState 제한" 규칙 생성 (3개)
2. 템플릿에 추가
3. MD 생성 → 스냅샷 생성 (3개로 고정)
4. 이후 "useState 제한" 규칙 편집 (3개 → 5개)
5. 템플릿에 알림: "원본 규칙이 변경되었습니다"
6. 선택:
   - 스냅샷 업데이트 (5개 적용)
   - 스냅샷 유지 (3개 유지)
   - 스냅샷 커스텀 (4개로 수정)
```

---

## 📊 데이터베이스 스키마

### 1. rules (마스터 규칙)
```sql
id: string (UUID)
name: string
description: string

-- 규칙 내용 (항상 최신!)
title: string
priority: enum ('critical', 'warning', 'info')
allowed: boolean (허용/비허용)
description_detail: text
example_bad: text
example_good: text
violation_action: text (위반 시 조치)
notes: text (기타)

created_at: timestamp
updated_at: timestamp
```

### 2. rule_snapshots (MD 생성 시점 스냅샷)
```sql
id: string (UUID)
base_rule_id: string (FK → rules)  -- 원본 마스터 규칙
template_id: string (FK → templates)  -- 어느 템플릿용
category_id: string (FK → categories)  -- 어느 카테고리에서

-- 스냅샷 내용 (생성 시점 고정)
snapshot_content: jsonb {
  title: string
  priority: enum
  allowed: boolean
  description_detail: text
  example_bad: text
  example_good: text
  violation_action: text
  notes: text
}

is_outdated: boolean (원본이 변경되었는지)
is_custom: boolean (커스텀 수정했는지)
created_at: timestamp  -- MD 생성 시점
```

### 3. categories (카테고리 - 평면 구조) ⭐
```sql
id: string (UUID)
name: string
description: text
order: integer
created_at: timestamp
updated_at: timestamp
```

### 4. category_rules (카테고리-규칙 연결)
```sql
id: string (UUID)
category_id: string (FK → categories)
rule_id: string (FK → rules)  -- 마스터 규칙 참조
order: integer
created_at: timestamp
```

### 5. category_presets (카테고리 프리셋) ⭐ NEW
```sql
id: string (UUID)
name: string
description: text
created_at: timestamp
updated_at: timestamp
```

### 6. category_preset_items (프리셋-카테고리 연결) ⭐ NEW
```sql
id: string (UUID)
preset_id: string (FK → category_presets)
category_id: string (FK → categories)
order: integer
created_at: timestamp
```

### 7. templates (템플릿)
```sql
id: string (UUID)
name: string
description: text
has_snapshots: boolean (MD 생성한 적 있는지)
last_generated_at: timestamp (마지막 MD 생성 시점)
outdated_count: integer (변경된 규칙 개수)
created_at: timestamp
updated_at: timestamp
```

### 8. template_categories (템플릿-카테고리 연결)
```sql
id: string (UUID)
template_id: string (FK → templates)
category_id: string (FK → categories)
order: integer
from_preset_id: string (FK → category_presets, nullable)  -- 프리셋에서 추가됐는지
created_at: timestamp
```

---

## 🎯 핵심 기능

### 1. 규칙 관리

#### 1.1 규칙 목록
- 모든 마스터 규칙 표시
- 검색 기능
- 우선순위별 필터
- 사용 중인 카테고리 개수 표시
- 사용 중인 템플릿 개수 표시
- 스냅샷 개수 표시

#### 1.2 규칙 추가
- 제목, 우선순위, 허용/비허용, 설명, 예시 입력
- 저장 → 마스터 규칙 생성

#### 1.3 규칙 편집
- 기존 규칙 수정
- 저장 → 마스터 규칙 업데이트
- 이 규칙의 스냅샷을 가진 템플릿 검색
- 스냅샷 내용 vs 마스터 내용 비교
- 다르면 is_outdated = true 설정
- 템플릿의 outdated_count 증가

#### 1.4 규칙 복사 ⭐
- 기존 규칙을 기반으로 새 규칙 생성
- 모든 필드 값 복사
- 이름에 " (복사)" 추가
- 복사 후 바로 편집 모드

#### 1.5 규칙 삭제
- 사용 중인 카테고리/템플릿이 없을 때만 삭제 가능
- 확인 다이얼로그

---

### 2. 카테고리 관리

#### 2.1 카테고리 목록 (평면) ⭐
- 모든 카테고리를 평면 리스트로 표시
- 검색 기능
- 사용 중인 프리셋 개수 표시
- 사용 중인 템플릿 개수 표시
- 포함된 규칙 개수 표시

#### 2.2 카테고리 추가
- 이름, 설명 입력

#### 2.3 카테고리 편집
- 이름, 설명 수정
- 규칙 추가/제거 (마스터 규칙 선택)
- 규칙 순서 변경

#### 2.4 카테고리 복사 ⭐
- 기존 카테고리를 기반으로 새 카테고리 생성
- 포함된 규칙 연결도 모두 복사
- 이름에 " (복사)" 추가
- 복사 후 바로 편집 모드

#### 2.5 카테고리 삭제
- 사용 중인 프리셋/템플릿이 없을 때만 삭제 가능
- 확인 다이얼로그

---

### 3. 카테고리 프리셋 관리 ⭐ NEW

#### 3.1 프리셋 목록
- 모든 프리셋 표시
- 검색 기능
- 포함된 카테고리 개수 표시
- 사용 중인 템플릿 개수 표시

#### 3.2 프리셋 추가
- 이름, 설명 입력
- 카테고리 선택 (다중 선택)
- 순서 지정

#### 3.3 프리셋 편집
- 이름, 설명 수정
- 카테고리 추가/제거
- 카테고리 순서 변경
- 미리보기 (포함된 모든 규칙 표시)

#### 3.4 프리셋 복사 ⭐
- 기존 프리셋을 기반으로 새 프리셋 생성
- 포함된 카테고리 연결도 모두 복사
- 이름에 " (복사)" 추가
- 복사 후 바로 편집 모드

#### 3.5 프리셋 삭제
- 사용 중인 템플릿이 있어도 삭제 가능
- 삭제 시 템플릿에서는 개별 카테고리로 남음
- 확인 다이얼로그

---

### 4. 템플릿 관리

#### 4.1 템플릿 목록
- 모든 템플릿 표시
- 검색 기능
- 변경 알림 뱃지 (outdated_count > 0)

#### 4.2 템플릿 추가
- 이름, 설명 입력

#### 4.3 템플릿 편집
- 이름, 설명 수정
- **[프리셋 추가]**: 프리셋 선택 → 포함된 카테고리 모두 추가 ⭐
- **[카테고리 추가]**: 개별 카테고리 추가
- 카테고리 순서 변경
- 카테고리 제거
- 프리셋 출처 표시 (어느 프리셋에서 왔는지)
- 변경사항 알림 (outdated 규칙)
- MD 미리보기
- MD 생성/다운로드/복사

#### 4.4 템플릿 삭제
- 확인 다이얼로그

---

### 5. 스냅샷 관리

#### 5.1 MD 생성 (스냅샷 생성)
```
동작:
1. 템플릿의 모든 카테고리 순회
2. 각 카테고리의 모든 규칙 순회
3. 규칙별로 스냅샷 생성:
   - base_rule_id = 마스터 규칙 ID
   - snapshot_content = 현재 마스터 규칙 내용
   - template_id = 현재 템플릿
   - category_id = 현재 카테고리
4. template.has_snapshots = true
5. template.last_generated_at = 현재 시각
6. MD 파일 생성
```

#### 5.2 변경사항 확인
```
템플릿 편집 페이지에서:
- outdated_count > 0이면 알림 표시
- [변경사항 보기] 버튼
- 클릭 시 다이얼로그:
  
  변경된 규칙 목록:
  
  1. useState 제한 (React 기본 규칙)
     스냅샷: 3개 제한
     현재:   5개 제한
     [비교] [업데이트] [유지]
  
  2. 매직넘버 금지 (코드 컨벤션)
     스냅샷: 0, 1 제외
     현재:   0, 1, -1 제외
     [비교] [업데이트] [유지]
```

#### 5.3 스냅샷 업데이트
```
선택지:
1. 업데이트
   - 스냅샷 내용 = 마스터 내용
   - is_outdated = false
   - is_custom = false

2. 유지
   - 스냅샷 그대로
   - is_outdated = false (무시 처리)

3. 커스텀
   - 스냅샷 내용 직접 편집
   - is_outdated = false
   - is_custom = true
```

#### 5.4 스냅샷 삭제 (마스터 사용)
```
스냅샷을 삭제하면:
- 해당 규칙은 항상 마스터 참조
- MD 생성 시 마스터의 최신 내용 사용
- 더 이상 변경 알림 받지 않음
```

---

## 🎨 UI/UX 플로우

### 페이지 구조

```
메인 레이아웃
├─ 사이드바
│  ├─ 템플릿 목록
│  ├─ 카테고리 프리셋 ⭐
│  ├─ 카테고리 저장소
│  └─ 규칙 저장소
│
└─ 메인 영역
   ├─ 템플릿 목록 페이지
   ├─ 템플릿 편집 페이지
   ├─ 프리셋 목록 페이지 ⭐
   ├─ 프리셋 편집 페이지 ⭐
   ├─ 카테고리 목록 페이지
   ├─ 카테고리 편집 페이지
   ├─ 규칙 목록 페이지
   └─ 규칙 편집 페이지
```

---

### 1. 템플릿 목록 페이지

```
┌─────────────────────────────────────┐
│ 🏠 템플릿 목록        [+ 새 템플릿] │
├─────────────────────────────────────┤
│ 🔍 [검색...]                         │
├─────────────────────────────────────┤
│ 📄 React 풀스택              🔔 3    │
│    5개 카테고리, 23개 규칙            │
│    [편집] [삭제] [MD 생성]            │
├─────────────────────────────────────┤
│ 📄 Vue 프로젝트                      │
│    3개 카테고리, 15개 규칙            │
│    [편집] [삭제] [MD 생성]            │
└─────────────────────────────────────┘
```

---

### 2. 템플릿 편집 페이지 ⭐

```
┌─────────────────────────────────────┐
│ ← 뒤로 | React 풀스택 템플릿         │
├─────────────────────────────────────┤
│ ⚠️ 3개 규칙이 원본과 달라졌습니다    │
│    [변경사항 보기]                   │
├─────────────────────────────────────┤
│ 이름: [React 풀스택                ] │
│ 설명: [풀스택 개발용...            ] │
├─────────────────────────────────────┤
│ [+ 프리셋 추가] [+ 카테고리 추가]    │
├─────────────────────────────────────┤
│ 포함된 카테고리:                     │
│                                      │
│ 📁 React 기본 규칙 (5개)        [×]  │
│    출처: React 표준 프리셋            │
│                                      │
│ 📁 JavaScript 에러 처리 (3개)   [×]  │
│    출처: React 표준 프리셋            │
│                                      │
│ 📁 TypeScript 기본 (4개)        [×]  │
│    출처: React 표준 프리셋            │
│                                      │
│ 📁 Next.js 전용 (2개)           [×]  │
│    출처: 직접 추가                    │
│                                      │
├─────────────────────────────────────┤
│ [MD 미리보기] [MD 생성] [저장]       │
└─────────────────────────────────────┘
```

---

### 3. 프리셋 추가 다이얼로그 ⭐

```
┌─────────────────────────────────────┐
│ 프리셋 선택                       [×] │
├─────────────────────────────────────┤
│ 사용 가능한 프리셋:                  │
│                                      │
│ ○ 📦 React 표준                      │
│    4개 카테고리 포함                 │
│    (React 기본, JS 에러, TS 기본...) │
│                                      │
│ ○ 📦 Vue 표준                        │
│    3개 카테고리 포함                 │
│                                      │
│ ○ 📦 Fullstack 기본                  │
│    4개 카테고리 포함                 │
│                                      │
│            [취소] [추가]             │
└─────────────────────────────────────┘
```

---

### 4. 프리셋 목록 페이지 ⭐

```
┌─────────────────────────────────────┐
│ 📦 카테고리 프리셋     [+ 새 프리셋] │
├─────────────────────────────────────┤
│ 🔍 [검색...]                         │
├─────────────────────────────────────┤
│ 📦 React 표준                        │
│    4개 카테고리, 23개 규칙            │
│    사용: 8개 템플릿                  │
│    [편집] [삭제]                      │
├─────────────────────────────────────┤
│ 📦 Vue 표준                          │
│    3개 카테고리, 15개 규칙            │
│    사용: 5개 템플릿                  │
│    [편집] [삭제]                      │
├─────────────────────────────────────┤
│ 📦 Fullstack 기본                    │
│    4개 카테고리, 18개 규칙            │
│    사용: 12개 템플릿                 │
│    [편집] [삭제]                      │
└─────────────────────────────────────┘
```

---

### 5. 프리셋 편집 페이지 ⭐

```
┌─────────────────────────────────────┐
│ ← 뒤로 | React 표준 프리셋           │
├─────────────────────────────────────┤
│ 이름: [React 표준                  ] │
│ 설명: [React 프로젝트 표준 규칙...  ] │
├─────────────────────────────────────┤
│ 포함된 카테고리:                     │
│                                      │
│ 📁 React 기본 규칙 (5개)        [×]  │
│ 📁 JavaScript 에러 처리 (3개)   [×]  │
│ 📁 TypeScript 기본 (4개)        [×]  │
│ 📁 코드 컨벤션 (6개)            [×]  │
│                                      │
│ [+ 카테고리 추가]                    │
├─────────────────────────────────────┤
│ 미리보기:                            │
│ 총 18개 규칙 포함                    │
│ • useState 3개 제한 🔴               │
│ • useEffect 2개 제한 🔴              │
│ • try-catch 필수 🟡                  │
│ ...                                  │
├─────────────────────────────────────┤
│            [취소] [저장]             │
└─────────────────────────────────────┘
```

---

### 6. 카테고리 목록 페이지 (평면) ⭐

```
┌─────────────────────────────────────┐
│ 📁 카테고리 저장소    [+ 새 카테고리] │
├─────────────────────────────────────┤
│ 🔍 [검색...]  [필터: 전체 ▼]         │
├─────────────────────────────────────┤
│ 📁 React 기본 규칙                   │
│    5개 규칙                          │
│    사용: 2개 프리셋, 8개 템플릿       │
│    [편집] [삭제]                      │
├─────────────────────────────────────┤
│ 📁 JavaScript 에러 처리               │
│    3개 규칙                          │
│    사용: 4개 프리셋, 15개 템플릿      │
│    [편집] [삭제]                      │
├─────────────────────────────────────┤
│ 📁 TypeScript 기본                   │
│    4개 규칙                          │
│    사용: 3개 프리셋, 10개 템플릿      │
│    [편집] [삭제]                      │
└─────────────────────────────────────┘
```

---

### 7. 규칙 목록 페이지

```
┌─────────────────────────────────────┐
│ 📜 규칙 저장소            [+ 새 규칙] │
├─────────────────────────────────────┤
│ 🔍 [검색...]  [필터: 전체 ▼]         │
├─────────────────────────────────────┤
│ 🔴 useState 3개 제한                 │
│    사용: 2개 카테고리, 5개 템플릿     │
│    스냅샷: 3개 템플릿                │
│    [편집] [삭제]                      │
├─────────────────────────────────────┤
│ 🟡 매직넘버 금지                     │
│    사용: 4개 카테고리, 8개 템플릿     │
│    스냅샷: 5개 템플릿                │
│    [편집] [삭제]                      │
└─────────────────────────────────────┘
```

---

## 🔄 워크플로우

### Flow 1: 프리셋 만들기 ⭐

```
1. [카테고리 프리셋] 메뉴 클릭
2. [+ 새 프리셋] 클릭
3. 이름: "React 표준"
   설명: "React 프로젝트 표준 규칙 세트"
4. [+ 카테고리 추가] 클릭
5. 카테고리 선택:
   ☑ React 기본 규칙
   ☑ JavaScript 에러 처리
   ☑ TypeScript 기본
   ☑ 코드 컨벤션
6. 순서 조정 (드래그앤드롭)
7. [미리보기] → 총 18개 규칙 확인
8. [저장]
```

---

### Flow 2: 템플릿 만들기 (프리셋 사용) ⭐

```
1. [+ 새 템플릿] 클릭
2. 이름: "React Next.js 프로젝트"
   설명: "Next.js 풀스택 프로젝트용"
3. [+ 프리셋 추가] 클릭
4. "React 표준" 프리셋 선택
5. [추가] → 4개 카테고리가 한번에 추가됨!
   
   포함된 카테고리:
   📁 React 기본 규칙 (출처: React 표준 프리셋)
   📁 JavaScript 에러 처리 (출처: React 표준 프리셋)
   📁 TypeScript 기본 (출처: React 표준 프리셋)
   📁 코드 컨벤션 (출처: React 표준 프리셋)

6. [+ 카테고리 추가] 클릭 (개별 추가)
7. "Next.js 전용 규칙" 선택
8. [저장]
```

---

### Flow 3: MD 생성 (스냅샷 생성)

```
1. 템플릿 편집 페이지
2. [MD 생성] 클릭
3. 시스템 동작:
   
   for 카테고리 in 템플릿.카테고리들:
       for 규칙 in 카테고리.규칙들:
           스냅샷 생성:
             - base_rule_id = 규칙.id
             - snapshot_content = 규칙.현재내용
             - template_id = 현재템플릿
             - category_id = 현재카테고리
   
   template.has_snapshots = true
   template.last_generated_at = now()

4. MD 파일 생성 (스냅샷 내용으로)
5. 다운로드/복사
```

---

### Flow 4: 규칙 수정 → 변경 알림

```
1. 규칙 목록에서 "useState 제한" 편집
2. 3개 → 5개로 수정
3. [저장]
4. 시스템 동작:
   
   마스터 규칙 업데이트
   
   스냅샷 검색:
     WHERE base_rule_id = 이 규칙
   
   for 스냅샷 in 스냅샷들:
       if 스냅샷.content != 마스터.content:
           스냅샷.is_outdated = true
           템플릿.outdated_count += 1

5. 영향받는 템플릿들에 뱃지 표시 🔔
```

---

### Flow 5: 변경사항 처리

```
1. 템플릿 편집 페이지
2. "3개 규칙이 원본과 달라졌습니다" 확인
3. [변경사항 보기] 클릭
4. 각 규칙별로 선택:

   A. 현재로 업데이트
      스냅샷.content = 마스터.content
      스냅샷.is_outdated = false
      템플릿.outdated_count -= 1
   
   B. 유지
      스냅샷.is_outdated = false (무시)
      템플릿.outdated_count -= 1
      (스냅샷 내용 그대로)
   
   C. 커스텀 편집
      스냅샷 편집 다이얼로그 열기
      내용 수정 (예: 4개로)
      스냅샷.is_custom = true
      스냅샷.is_outdated = false
      템플릿.outdated_count -= 1

5. [적용]
```

---

### Flow 6: 프리셋 수정 시 영향 ⭐

```
시나리오:
1. "React 표준" 프리셋에서 "코드 컨벤션" 카테고리 제거
2. [저장]
3. 시스템:
   - 프리셋만 업데이트
   - 이미 프리셋을 사용한 템플릿은 영향 없음!
   - 템플릿에는 개별 카테고리로 남아있음

주의:
- 프리셋은 "스탬프" 같은 개념
- 한번 찍으면 독립적으로 존재
- 프리셋 수정해도 기존 템플릿에 자동 반영 안됨
```

---

## 🛠️ 기술 스택

### Frontend
- Next.js 15.5
- React 19
- TypeScript
- Tailwind CSS
- shadcn/ui (button, input, textarea, dialog, toast)

### Backend
- Next.js API Routes
- Prisma ORM

### Database
- Supabase (PostgreSQL)

### Deployment
- Vercel

---

## 📅 개발 단계

### Phase 1: MVP - 규칙 (1주)
```
✅ 프로젝트 셋업
✅ DB 스키마 설계
✅ 규칙 CRUD
   - 목록
   - 추가
   - 편집 (마스터 업데이트만)
   - 삭제
✅ 기본 UI (목록 + 다이얼로그)
```

### Phase 2: 카테고리 (1주)
```
□ 카테고리 CRUD (평면 구조)
□ 카테고리-규칙 연결 (마스터 참조)
□ 규칙 추가/제거 UI
```

### Phase 3: 프리셋 (1주) ⭐
```
□ 프리셋 CRUD
□ 프리셋-카테고리 연결
□ 프리셋 미리보기
□ 프리셋 선택 UI
```

### Phase 4: 템플릿 (1주)
```
□ 템플릿 CRUD
□ 프리셋 추가 기능
□ 개별 카테고리 추가 기능
□ 출처 표시 (프리셋 vs 직접)
□ MD 생성 로직
□ MD 미리보기
□ MD 다운로드/복사
```

### Phase 5: 스냅샷 관리 (1주)
```
□ MD 생성 시 스냅샷 생성
□ 마스터 수정 시 변경 감지
□ 변경사항 비교 UI
□ 스냅샷 업데이트/유지/커스텀
□ 스냅샷 삭제 (마스터 사용)
```

### Phase 6: 개선 (1주)
```
□ 검색 기능
□ 필터링
□ 정렬
□ 사용 통계
□ UI/UX 개선
□ 성능 최적화
```

---

## 🎯 MVP 우선순위

### 필수 기능
1. 규칙 추가/편집/삭제/목록 (마스터만)
2. 규칙 편집 다이얼로그 (8개 필드)
3. 저장 성공 토스트

### Phase 2 추가
4. 카테고리 CRUD
5. 카테고리에 규칙 추가

### Phase 3 추가
6. 프리셋 CRUD
7. 프리셋에 카테고리 추가

### Phase 4 추가
8. 템플릿 CRUD
9. 프리셋/카테고리 선택
10. MD 생성

---

## 📝 데이터 예시

### 카테고리
```json
{
  "id": "cat-001",
  "name": "React 기본 규칙",
  "description": "React 컴포넌트 작성 기본 규칙",
  "order": 1
}
```

### 카테고리 프리셋 ⭐
```json
{
  "id": "preset-001",
  "name": "React 표준",
  "description": "React 프로젝트 표준 규칙 세트",
  "categories": [
    {
      "category_id": "cat-001",
      "order": 1
    },
    {
      "category_id": "cat-002",
      "order": 2
    }
  ]
}
```

### 템플릿
```json
{
  "id": "template-001",
  "name": "React Next.js 프로젝트",
  "description": "Next.js 풀스택 프로젝트용",
  "categories": [
    {
      "category_id": "cat-001",
      "from_preset_id": "preset-001",
      "order": 1
    },
    {
      "category_id": "cat-002",
      "from_preset_id": "preset-001",
      "order": 2
    },
    {
      "category_id": "cat-005",
      "from_preset_id": null,  // 직접 추가
      "order": 3
    }
  ]
}
```

---

## 🚀 첫 번째 구현 목표

### Sprint 1 (MVP)
**목표: 규칙 CRUD 완성 (마스터만)**

```
□ Supabase 프로젝트 생성
□ Prisma 스키마 작성 (rules만)
□ API Routes 작성
  - GET /api/rules (목록)
  - POST /api/rules (추가)
  - PUT /api/rules/:id (편집 → 마스터 업데이트)
  - DELETE /api/rules/:id (삭제)
□ UI 구현
  - 규칙 목록 페이지
  - 규칙 추가 다이얼로그
  - 규칙 편집 다이얼로그
  - 삭제 확인 다이얼로그
  - 토스트 알림
□ 테스트
  - 5개 규칙 추가
  - 편집 → 마스터 업데이트 확인
  - 삭제 동작 확인
```

---

## 📚 참고사항

### 규칙 내용 필드
모든 규칙(마스터/스냅샷)은 다음 필드를 가짐:
1. title (제목)
2. priority (우선순위: critical/warning/info)
3. allowed (허용/비허용: true/false)
4. description_detail (설명)
5. example_bad (잘못된 예시)
6. example_good (올바른 예시)
7. violation_action (위반 시 조치)
8. notes (기타)

### MD 생성 로직
```
1. 템플릿의 카테고리들 순회
2. 각 카테고리의 규칙들 순회
3. 규칙별로:
   - 스냅샷 있으면: 스냅샷 내용 사용
   - 스냅샷 없으면: 마스터 내용 사용
4. 마크다운 형식으로 조합
```

### MD 생성 포맷
```markdown
# {템플릿명}

{템플릿 설명}

---

## {카테고리명}

### {규칙 제목} {우선순위 아이콘}

**{허용/비허용}**

{설명}

❌ **잘못된 예시:**
```
{example_bad}
```

✅ **올바른 예시:**
```
{example_good}
```

**위반 시:** {violation_action}

📝 **참고:** {notes}

---
```

---

## ✅ 체크리스트

### 프로젝트 셋업
- [ ] Next.js 프로젝트 생성
- [ ] shadcn/ui 초기화
- [ ] 5개 컴포넌트 설치
- [ ] Supabase 프로젝트 생성
- [ ] Prisma 설정
- [ ] 환경변수 설정

### Phase 1: 규칙
- [ ] DB 스키마 (rules만)
- [ ] API Routes (CRUD)
- [ ] 규칙 목록 UI
- [ ] 규칙 추가 다이얼로그
- [ ] 규칙 편집 다이얼로그
- [ ] 삭제 확인
- [ ] 토스트 알림

### Phase 2: 카테고리
- [ ] DB 스키마 (categories, category_rules)
- [ ] API Routes (CRUD)
- [ ] 카테고리 목록 UI (평면)
- [ ] 카테고리 편집 UI
- [ ] 규칙 추가/제거 UI

### Phase 3: 프리셋 ⭐
- [ ] DB 스키마 (category_presets, category_preset_items)
- [ ] API Routes (CRUD)
- [ ] 프리셋 목록 UI
- [ ] 프리셋 편집 UI
- [ ] 카테고리 선택 UI
- [ ] 프리셋 미리보기

### Phase 4: 템플릿
- [ ] DB 스키마 (templates, template_categories)
- [ ] API Routes (CRUD)
- [ ] 템플릿 목록 UI
- [ ] 템플릿 편집 UI
- [ ] 프리셋 추가 기능
- [ ] 카테고리 추가 기능
- [ ] 출처 표시
- [ ] MD 생성
- [ ] MD 미리보기

### Phase 5: 스냅샷
- [ ] DB 스키마 (rule_snapshots)
- [ ] 스냅샷 생성 로직
- [ ] 변경 감지 로직
- [ ] 변경사항 UI
- [ ] 업데이트/유지/커스텀

---

## 🔍 핵심 요약

### 4계층 구조 ⭐
1. **규칙** - 가장 작은 단위 (마스터)
2. **카테고리** - 규칙들의 그룹 (평면)
3. **프리셋** - 카테고리들의 조합 (스탬프)
4. **템플릿** - 프리셋 + 개별 카테고리 (최종)

### 프리셋의 특징 ⭐
- 자주 쓰는 카테고리 조합을 미리 저장
- 템플릿 만들 때 한번에 추가 가능
- "스탬프" 개념 - 한번 찍으면 독립적
- 프리셋 수정해도 기존 템플릿 영향 없음

### 스냅샷
- MD 생성 시점 고정
- 변경 추적 가능
- 독립적 관리

---

이 기획서를 바탕으로 순차적으로 구현을 진행하세요!